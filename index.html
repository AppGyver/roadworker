<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Roadworker by winebarrel</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Roadworker</h1>
        <h2>Roadworker is a tool to manage Route53. It defines the state of Route53 using DSL, and updates Route53 according to DSL.</h2>

        <section id="downloads">
          <a href="https://github.com/winebarrel/roadworker/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/winebarrel/roadworker/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/winebarrel/roadworker" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p><strong>Notice</strong></p>

<ul>
<li>Roadworker cannot update TTL of two or more same weighted A records (with different SetIdentifier) after creation.</li>
<li>
<code>&gt;= 0.4.3</code> compare resource records ignoring the order.</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<pre><code>gem 'roadworker'
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install roadworker
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<div class="highlight highlight-sh"><pre><span class="pl-s">export</span> AWS_ACCESS_KEY_ID=<span class="pl-s1"><span class="pl-pds">'</span>...<span class="pl-pds">'</span></span>
<span class="pl-s">export</span> AWS_SECRET_ACCESS_KEY=<span class="pl-s1"><span class="pl-pds">'</span>...<span class="pl-pds">'</span></span>
roadwork -e -o Routefile
vi Routefile
roadwork -a --dry-run
roudwork -a</pre></div>

<h2>
<a id="help" class="anchor" href="#help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Help</h2>

<pre><code>Usage: roadwork [options]
    -p, --profile PROFILE_NAME
        --credentials-path PATH
    -k, --access-key ACCESS_KEY
    -s, --secret-key SECRET_KEY
    -a, --apply
    -f, --file FILE
        --dry-run
        --force
        --no-health-check-gc
    -e, --export
    -o, --output FILE
        --split
        --with-soa-ns
    -t, --test
        --nameservers SERVERS
        --port PORT
        --target-zone REGEXP
        --no-color
        --debug
</code></pre>

<h2>
<a id="routefile-example" class="anchor" href="#routefile-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Routefile example</h2>

<div class="highlight highlight-ruby"><pre><span class="pl-k">require</span> <span class="pl-s1"><span class="pl-pds">'</span>other/routefile<span class="pl-pds">'</span></span>

hosted_zone <span class="pl-s1"><span class="pl-pds">"</span>winebarrel.jp.<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
  rrset <span class="pl-s1"><span class="pl-pds">"</span>winebarrel.jp.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    ttl <span class="pl-c1">300</span>
    resource_records(
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.2<span class="pl-pds">"</span></span>
    )
  <span class="pl-k">end</span>

  rrset <span class="pl-s1"><span class="pl-pds">"</span>winebarrel.jp.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>MX<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    ttl <span class="pl-c1">300</span>
    resource_records(
      <span class="pl-s1"><span class="pl-pds">"</span>10 mx.winebarrel.jp<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>10 mx2.winebarrel.jp<span class="pl-pds">"</span></span>
    )
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

hosted_zone <span class="pl-s1"><span class="pl-pds">"</span>info.winebarrel.jp.<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
  rrset <span class="pl-s1"><span class="pl-pds">"</span>xxx.info.winebarrel.jp.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    dns_name <span class="pl-s1"><span class="pl-pds">"</span>elb-dns-name.elb.amazonaws.com<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>

  rrset <span class="pl-s1"><span class="pl-pds">"</span>yyy.info.winebarrel.jp.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    dns_name <span class="pl-s1"><span class="pl-pds">"</span>elb-dns-name2.elb.amazonaws.com<span class="pl-pds">"</span></span>, <span class="pl-c1">:evaluate_target_health</span> =&gt; <span class="pl-c1">true</span>
  <span class="pl-k">end</span>

  rrset <span class="pl-s1"><span class="pl-pds">"</span>zzz.info.winebarrel.jp<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    set_identifier <span class="pl-s1"><span class="pl-pds">"</span>Primary<span class="pl-pds">"</span></span>
    failover <span class="pl-s1"><span class="pl-pds">"</span>PRIMARY<span class="pl-pds">"</span></span>
    health_check <span class="pl-s1"><span class="pl-pds">"</span>http://example.com:80/path<span class="pl-pds">"</span></span>, <span class="pl-c1">:search_string</span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>ANY_RESPONSE_STRING<span class="pl-pds">"</span></span>, <span class="pl-c1">:request_interval</span> =&gt; <span class="pl-c1">30</span>, <span class="pl-c1">:failure_threshold</span> =&gt; <span class="pl-c1">3</span>
    <span class="pl-c"># If you want to specify the IP address:</span>
    <span class="pl-c">#health_check "http://192.0.43.10:80/path", :host =&gt; "example.com",...</span>
    ttl <span class="pl-c1">456</span>
    resource_records(
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.2<span class="pl-pds">"</span></span>
    )
  <span class="pl-k">end</span>

  rrset <span class="pl-s1"><span class="pl-pds">"</span>zzz.info.winebarrel.jp<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    set_identifier <span class="pl-s1"><span class="pl-pds">"</span>Secondary<span class="pl-pds">"</span></span>
    failover <span class="pl-s1"><span class="pl-pds">"</span>SECONDARY<span class="pl-pds">"</span></span>
    health_check <span class="pl-s1"><span class="pl-pds">"</span>tcp://192.0.43.10:3306<span class="pl-pds">"</span></span>, <span class="pl-c1">:request_interval</span> =&gt; <span class="pl-c1">30</span>, <span class="pl-c1">:failure_threshold</span> =&gt; <span class="pl-c1">3</span>
    ttl <span class="pl-c1">456</span>
    resource_records(
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.3<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.4<span class="pl-pds">"</span></span>
    )
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-c"># Private HostedZone</span>
hosted_zone <span class="pl-s1"><span class="pl-pds">"</span>winebarrel.local.<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
  vpc <span class="pl-s1"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>vpc-xxxxxxxx<span class="pl-pds">"</span></span>
  vpc <span class="pl-s1"><span class="pl-pds">"</span>us-east-2<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>vpc-xxxxxxxx<span class="pl-pds">"</span></span>

  rrset <span class="pl-s1"><span class="pl-pds">"</span>winebarrel.local.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    ttl <span class="pl-c1">300</span>
    resource_records(
      <span class="pl-s1"><span class="pl-pds">"</span>10.0.0.1<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>10.0.0.2<span class="pl-pds">"</span></span>
    )
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<h3>
<a id="dynamic-private-dns-example" class="anchor" href="#dynamic-private-dns-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic private DNS example</h3>

<div class="highlight highlight-ruby"><pre>hosted_zone <span class="pl-s1"><span class="pl-pds">"</span>us-east-1.my.local.<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
  vpc <span class="pl-s1"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>vpc-xxxxxxxx<span class="pl-pds">"</span></span>

  <span class="pl-s3">AWS</span>::<span class="pl-s3">EC2</span>.<span class="pl-k">new</span>(<span class="pl-c1">region:</span> <span class="pl-s1"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>).vpcs[<span class="pl-s1"><span class="pl-pds">"</span>vpc-xxxxxxxx<span class="pl-pds">"</span></span>].instances.each {|<span class="pl-vo">instance</span>|
    rrset <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pse">#{</span><span class="pl-s2">instance.tags.<span class="pl-vo">Name</span></span><span class="pl-pse"><span class="pl-s2">}</span></span>.us-east-1.my.local.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
      ttl <span class="pl-c1">300</span>
      resource_records instance.private_ip_address
    <span class="pl-k">end</span>
  }
<span class="pl-k">end</span></pre></div>

<h2>
<a id="test" class="anchor" href="#test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test</h2>

<p>Routefile compares the results of a query to the DNS and DSL in the test mode.</p>

<pre><code>shell&gt; roadwork -t
..F..
info.winebarrel.jp. A:
  expected=127.0.0.1(300),127.0.0.3(300)
  actual=127.0.0.1(300),127.0.0.2(300)
5 examples, 1 failure
</code></pre>

<p>(Please note test of A(Alias) is not possible to perfection...)</p>

<h2>
<a id="demo" class="anchor" href="#demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demo</h2>

<p><img src="https://raw.githubusercontent.com/winebarrel/roadworker/master/etc/demo.gif" alt="Roadworker Demo"></p>

<h2>
<a id="dns-management-using-githubbitbucket" class="anchor" href="#dns-management-using-githubbitbucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>DNS management using GitHub/Bitbucket</h2>

<p><img src="https://cacoo.com/diagrams/geJfslZqd8qne90t-BC7C7.png" alt="DNS management using Git"></p>

<ul>
<li><a href="https://bitbucket.org/winebarrel/roadworker-example/src">Bitbucket example repository</a></li>
<li><a href="https://drone.io/bitbucket.org/winebarrel/roadworker-example/latest">drone.io example project</a></li>
</ul>

<h2>
<a id="link" class="anchor" href="#link" aria-hidden="true"><span class="octicon octicon-link"></span></a>Link</h2>

<ul>
<li><a href="http://rubygems.org/gems/roadworker">RubyGems.org site</a></li>
</ul>
      </section>
    </div>

    
  </body>
</html>